/* eslint-disable */

const { readFileSync, writeFileSync } = require("fs");

const FILE = {
  EVERY: "./src/asset/silksong/categories/every.json",
  ICONS: "./src/asset/silksong/icons/icons.ts",
};

const splits = require("../src/asset/silksong/splits.json");

// TODO: figure out good way to have tools and web share common code
const DESCRIPTION_NAME_REGEXP = /(?<name>.+)\s+\((?<qualifier>.+)\)/;
function getNameAndGroup({ description }) {
  const match = DESCRIPTION_NAME_REGEXP.exec(description);
  let name = description;
  let qualifier = "Other";

  if (match && match.groups) {
    ({ name, qualifier } = match.groups);
  }

  return [name, qualifier];
}
function parseSplitsDefinitions() {
  const splitDefinitions = new Map();
  for (const { description, key, tooltip } of splits) {
    const id = key;
    const [name, qualifier] = getNameAndGroup({ description });
    splitDefinitions.set(id, {
      id,
      qualifier,
    });
  }

  return splitDefinitions;
}

const Splits = [...parseSplitsDefinitions().values()];

const every = {
  categoryName: "EVERY AUTOSPLIT",
  splitIds: ["StartNewGame", ...Splits.map(({ id }) => id)],
  gameName: "Hollow Knight: Silksong Category Extensions",
};

function createEvery() {
  const output = JSON.stringify(every, null, 4) + "\n";
  writeFileSync(FILE.EVERY, output);
}

const NEW_ID_MAP = {};

function getUrl(qualifier, id) {
  switch (id) {
    // Misc
    case "ManualSplit":
    case "StartNewGame":
    case "PlayerDeath":
    case "AnyTransition":
      return getUrl("Misc", "Hornet");

    // Menu
    case "Menu":
      return getUrl("Item", "Map");

    // Bell
    case "MarrowBell":
    case "DeepDocksBell":
    case "GreymoorBell":
    case "ShellwoodBell":
    case "BellhartBell":
      return getUrl("Misc", "Bell");

    // Skill Transition
    case "SilkSpearTrans":
      return getUrl("Skill", "SilkSpear");

    case "SwiftStepTrans":
      return getUrl("Skill", "SwiftStep");
    case "DriftersCloakTrans":
      return getUrl("Skill", "DriftersCloak");
    case "ClingGripTrans":
      return getUrl("Skill", "ClingGrip");
    case "ClawlineTrans":
      return getUrl("Skill", "Clawline");

    // Area Transition
    case "EnterGreymoor":
      return getUrl("Enemy", "Craw");
    case "EnterMist":
    case "LeaveMist":
      return getUrl("Enemy", "Wraith");
    case "EnterHighHalls":
      return getUrl("Enemy", "Minister");
    case "EnterHighHallsGauntlet":
      return getUrl("Enemy", "Maestro");

    // Boss Transition
    case "MossMotherTrans":
      return getUrl("Boss", "MossMother");
    case "BellBeastTrans":
      return getUrl("Boss", "BellBeast");
    case "Lace1Trans":
      return getUrl("Boss", "Lace");
    case "MoorwingTrans":
      return getUrl("Boss", "Moorwing");
    case "TrobbioTrans":
      return getUrl("Boss", "Trobbio");

    // Melody Transition
    case "VaultkeepersMelodyTrans":
      return getUrl("Melody", "VaultkeepersMelody");
    case "ArchitectsMelodyTrans":
      return getUrl("Melody", "ArchitectsMelody");
    case "ConductorsMelodyTrans":
      return getUrl("Melody", "ConductorsMelody");

    // Mini Boss
    case "WhisperingVaultsGauntlet":
      return getUrl("Enemy", "Vaultkeeper");
    case "HighHallsGauntlet":
      return getUrl("Enemy", "ChoirClapper");

    // Needle Upgrade
    case "NeedleUpgrade1":
      return getUrl("Item", "Needle1");
    case "NeedleUpgrade2":
      return getUrl("Item", "Needle2");
    case "NeedleUpgrade3":
      return getUrl("Item", "Needle3");
    case "NeedleUpgrade4":
      return getUrl("Item", "Needle4");

    // Lace
    case "Lace1":
    case "Lace2":
      return getUrl("Boss", "Lace");

    // Ending
    case "EndingSplit":
    case "EndingA":
      return getUrl("Boss", "GrandMotherSilk");
  }

  const newId = NEW_ID_MAP[id] || id;
  return `./${qualifier}/${newId}.png`;
}

function createIconImports() {
  let output =
    "/* eslint-disable */\n/* THIS FILE IS AUTOMATICALLY GENERATED */\n";
  for (const { id, qualifier } of Splits) {
    output += `import ${id} from "${getUrl(qualifier, id)}";\n`;
  }

  // non-split icons
  // output += `import TheHollowKnight from "./Achievement/TheHollowKnight.png";\n`;

  // console.log(output);
  output += "export default {\n";
  for (const { id } of Splits) {
    output += `  ${id},\n`;
  }
  //   output += `  TheHollowKnight,\n`;
  output += "};\n";

  // console.log(output);
  writeFileSync(FILE.ICONS, output);
}

createEvery();
createIconImports();
